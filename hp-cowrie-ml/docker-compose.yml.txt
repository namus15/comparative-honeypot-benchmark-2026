version: '3.8'

services:
  cowrie-ml:
    build: .
    container_name: cowrie-isolationforest
    restart: unless-stopped
    ports:
      - "2222:2222/tcp"          # Puerto SSH expuesto públicamente
    volumes:
      - cowrie-data:/cowrie/var/lib/cowrie/
      - cowrie-logs:/cowrie/var/log/cowrie/
      - ./isolationforest_detector.py:/cowrie/src/isolationforest_detector.py:ro
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      - TZ=Europe/Berlin          # Zona horaria realista (Hetzner Alemania)
      - COWRIE_LOG_LEVEL=INFO
      - COWRIE_AUTH_CLASS=anon    # Autenticación anónima para honeypot
      - COWRIE_HONEYPOT_ENABLED=1
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "2222"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  cowrie-data:
  cowrie-logs: